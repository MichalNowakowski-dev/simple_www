<!doctype html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <title>Ewidencja Wpłat</title>
    <style>
      body {
        font-family: sans-serif;
        max-width: 600px;
        margin: 40px auto;
        padding: 20px;
      }
      .summary {
        background: #f4f4f4;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 1.2em;
      }
      .payment-item {
        border-bottom: 1px solid #ddd;
        padding: 10px 0;
        display: flex;
        justify-content: space-between;
      }
      input {
        padding: 8px;
        margin-right: 10px;
      }
      button {
        padding: 8px 15px;
        background: #28a745;
        color: white;
        border: none;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h2>Rejestracja Wpłaty</h2>

    <div class="summary">
      <strong>Razem zebrano: <span id="total-amount">0.00</span> PLN</strong>
    </div>

    <div id="form">
      <input type="text" id="person" placeholder="Imię i Nazwisko" />
      <input
        type="number"
        id="amount"
        step="0.01"
        placeholder="Kwota (np. 50.00)"
      />
      <button onclick="addPayment()">Wpłać</button>
    </div>

    <h3>Lista ostatnich wpłat:</h3>
    <div id="payments-list"></div>

    <script>
      async function loadData() {
        const res = await fetch("/api/payments");
        const data = await res.json();

        document.getElementById("total-amount").innerText = parseFloat(
          data.total,
        ).toFixed(2);

        const list = document.getElementById("payments-list");
        list.innerHTML = data.list
          .map(
            (p) => `
                <div class="payment-item">
                    <span><strong>${p.person}</strong></span>
                    <span>${parseFloat(p.amount).toFixed(2)} PLN</span>
                </div>
            `,
          )
          .join("");
      }

      async function addPayment() {
        const person = document.getElementById("person").value;
        const amount = document.getElementById("amount").value;

        if (!person || !amount) return alert("Wypełnij pola!");

        await fetch("/api/payments", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ person, amount }),
        });

        document.getElementById("person").value = "";
        document.getElementById("amount").value = "";
        loadData();
      }

      loadData();
    </script>
  </body>
</html>
